(self.webpackChunktomp=self.webpackChunktomp||[]).push([[2657],{64317:function(X,E,n){"use strict";var m=n(67294),y=n(74308),l=n(22270),g=n(66758),B=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],C=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"];function x(){return x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},x.apply(this,arguments)}function D(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),a.push.apply(a,s)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?D(Object(a),!0).forEach(function(s){T(e,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(a,s))})}return e}function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function j(e,t){if(e==null)return{};var a=P(e,t),s,f;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(f=0;f<p.length;f++)s=p[f],!(t.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,s)||(a[s]=e[s]))}return a}function P(e,t){if(e==null)return{};var a={},s=Object.keys(e),f,p;for(p=0;p<s.length;p++)f=s[p],!(t.indexOf(f)>=0)&&(a[f]=e[f]);return a}var w=m.forwardRef(function(e,t){var a=e.fieldProps,s=e.children,f=e.params,p=e.proFieldProps,U=e.mode,K=e.valueEnum,Z=e.request,W=e.showSearch,L=e.options,h=j(e,B),N=(0,m.useContext)(g.Z);return m.createElement(y.Z,x({mode:"edit",valueEnum:(0,l.h)(K),request:Z,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:R({options:L,mode:U,showSearch:W,getPopupContainer:N.getPopupContainer},a),ref:t,proFieldProps:p},h),s)}),G=m.forwardRef(function(e,t){var a=e.fieldProps,s=e.children,f=e.params,p=e.proFieldProps,U=e.mode,K=e.valueEnum,Z=e.request,W=e.options,L=j(e,C),h=R({options:W,mode:U||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label",filterOption:!1},a),N=(0,m.useContext)(g.Z);return m.createElement(y.Z,x({mode:"edit",valueEnum:(0,l.h)(K),request:Z,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:R({getPopupContainer:N.getPopupContainer},h),ref:t,proFieldProps:p},L),s)}),c=w,o=G,r=c;r.SearchSelect=o,r.displayName="ProFormComponent",E.Z=r},37598:function(X,E,n){"use strict";var m=n(11849),y=n(22542),l=n(85893),g=function(C){var x={search:!1,options:!1,pagination:{defaultPageSize:15,pageSizeOptions:["15","30","50"],showSizeChanger:!0}};return(0,l.jsx)(y.ZP,(0,m.Z)({"data-inspector-line":"21","data-inspector-column":"9","data-inspector-relative-path":"src/components/CustomProTable/index.tsx"},Object.assign({},x,C)))};E.Z=g},41801:function(X,E,n){"use strict";n.r(E),n.d(E,{default:function(){return ve}});var m=n(58024),y=n(39144),l=n(63185),g=n(9676),B=n(20228),C=n(11382),x=n(62350),D=n(75443),R=n(57663),T=n(71577),j=n(32059),P=n(11849),w=n(86582),G=n(34792),c=n(48086),o=n(3182),r=n(2824),e=n(94043),t=n.n(e),a=n(37598),s=n(67265),f=n(2489),p=n(67294),U=function($,b){var A=(0,p.useRef)(function(){});(0,p.useEffect)(function(){A.current=$}),(0,p.useEffect)(function(){if(b!==null){var Q=setInterval(function(){return A.current()},b||0);return function(){return clearInterval(Q)}}},[b])},K=U,Z=n(79278),W=n(64317),L=n(68438),h=n(85893),N=function(b){switch(b){case"Stoppend":case"Exited":return"\u5DF2\u505C\u6B62";case"Starting":return"\u542F\u52A8\u4E2D";case"Running":return"\u8FD0\u884C\u4E2D";case"Backoff":return"\u91CD\u8BD5\u4E2D";case"Stopping":return"\u505C\u6B62\u4E2D";case"Fatal":return"\u81F4\u547D\u9519\u8BEF";case"Unknown":default:return"\u672A\u77E5\u72B6\u6001"}},J=function(b){switch(b){case"Start":return"\u542F\u52A8";case"Restart":return"\u91CD\u542F";case"Stop":default:return"\u505C\u6B62"}},Y="ServerManage-Inspection-autoRefresh",de=function(b){var A,Q=(0,p.useState)(!1),_=(0,r.Z)(Q,2),fe=_[0],q=_[1],me=(0,p.useState)(!1),ee=(0,r.Z)(me,2),H=ee[0],te=ee[1],he=(0,p.useState)({}),ne=(0,r.Z)(he,2),ge=ne[0],re=ne[1],Se=(0,p.useState)((A=(0,L.N8)(Y))!==null&&A!==void 0?A:!0),ae=(0,r.Z)(Se,2),z=ae[0],Pe=ae[1],Me=(0,p.useState)([]),se=(0,r.Z)(Me,2),I=se[0],V=se[1],Oe=(0,p.useState)(parseInt(b.match.params.id)),ie=(0,r.Z)(Oe,2),k=ie[0],xe=ie[1],be=15*1e3,Ie=function(){var O=(0,o.Z)(t().mark(function d(){var u;return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return q(!0),v.next=3,(0,Z.x)({page:1,limit:1e4}).then(function(i){if(i.code===0){var S;return((S=i.data)===null||S===void 0?void 0:S.dataList)||[]}else return i.msg&&c.default.error(i.msg),[]}).catch(function(i){return c.default.error(i),[]}).finally(function(){q(!1)});case 3:return u=v.sent,v.abrupt("return",u.map(function(i){var S=i.serverId,F=i.serverIp;return{value:S,label:F}}));case 5:case"end":return v.stop()}},d)}));return function(){return O.apply(this,arguments)}}(),oe=(0,f.md)(),Ee=(0,p.useRef)(),ye=function(){f.m8.goBack()},ce=function(){te(!0),(0,Z.Gl)(k).then(function(d){d.code===0?V(d.data||[]):(d.msg&&c.default.error(d.msg),V([]))}).catch(function(d){c.default.error(d)}).finally(function(){te(!1)})},Ze=function(d){(0,Z.Gl)(k).then(function(u){u.code===0?(I.forEach(function(M){if(d.includes(M.name)){var v,i=(v=u.data)===null||v===void 0?void 0:v.find(function(S){return S.name===M.name});i&&(M.stateName=i==null?void 0:i.stateName,M.uptime=i==null?void 0:i.uptime,M.uptimeDesc=i==null?void 0:i.uptimeDesc,M.pid=i==null?void 0:i.pid,M.enableRestart=i==null?void 0:i.enableRestart)}}),V((0,w.Z)(I))):u.msg&&c.default.error(u.msg)}).catch(function(u){c.default.error(u)})};K(function(){console.log("request"),ce()},z?be:null),(0,p.useEffect)(function(){ce()},[k]);var ue=function(d,u){console.log("".concat(d," Service"),u);var M=J(d);re(function(v){return(0,P.Z)((0,P.Z)({},v),u.reduce(function(i,S){return(0,P.Z)((0,P.Z)({},i),{},(0,j.Z)({},S,!0))},{}))}),u.forEach(function(v){var i=I==null?void 0:I.findIndex(function(S){return S.name===v});~i&&(I.splice(i,1,(0,P.Z)((0,P.Z)({},I[i]),{},{stateName:d==="Stop"?"Stopping":"Starting"})),V((0,w.Z)(I)))}),(0,Z.X1)(k,d,u).then(function(v){v.code===0?(c.default.success("".concat(M,"\u670D\u52A1\u6210\u529F")),re(function(i){return(0,P.Z)((0,P.Z)({},i),u.reduce(function(S,F){return(0,P.Z)((0,P.Z)({},S),{},(0,j.Z)({},F,!1))},{}))}),Ze(u)):v.msg&&c.default.error(v.msg)}).catch(function(v){c.default.error(v)})},Ce=function(){console.log("toggleAutoRefresh"),Pe(!z),(0,L.Rh)(!z,Y)},De=function(d){xe(d),f.m8.replace("/server-manage/inspection/machine-services/".concat(d))},je=[{title:"\u670D\u52A1\u540D\u79F0",align:"center",dataIndex:"name"},{title:"ip\u5730\u5740",align:"center",dataIndex:"ip"},{title:"\u8FDB\u7A0B\u53F7",align:"center",dataIndex:"pid",render:function(d){return d||"-"}},{title:"\u5F53\u524D\u72B6\u6001",align:"center",render:function(d,u){return N(u.stateName)}},{title:"\u8FD0\u884C\u65F6\u957F",align:"center",dataIndex:"uptimeDesc"},{title:"\u64CD\u4F5C",align:"center",valueType:"option",render:function(d,u){var M=u.stateName!=="Running"?"Start":"Stop",v=J(M),i=["Starting","Backoff","Stopping","Fatal","Unknown"],S=["Starting","Backoff","Stopping","Exited","Fatal","Unknown"],F=i.includes(u.stateName),le=u.enableStop===!1||F,pe=u.enableRestart===!1||S.includes(u.stateName);return(0,h.jsxs)(C.Z,{"data-inspector-line":"263","data-inspector-column":"10","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",spinning:Boolean(ge[u.name]),children:[(0,h.jsx)(f.Nv,{"data-inspector-line":"264","data-inspector-column":"12","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",accessible:oe["service.patrol.serviceoperate"],children:(0,h.jsx)(D.Z,{"data-inspector-line":"265","data-inspector-column":"14","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",disabled:M==="Stop"?le:F,title:"\u786E\u5B9A".concat(v,"\u670D\u52A1\u5417\uFF1F"),okButtonProps:{danger:!0},onConfirm:ue.bind(null,M,[u.name]),children:(0,h.jsx)(T.Z,{"data-inspector-line":"273","data-inspector-column":"16","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",disabled:le,type:"link",children:v})})}),(0,h.jsx)(f.Nv,{"data-inspector-line":"278","data-inspector-column":"12","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",accessible:oe["service.patrol.serviceoperate"],children:(0,h.jsx)(D.Z,{"data-inspector-line":"279","data-inspector-column":"14","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",disabled:pe,title:"\u786E\u5B9A\u91CD\u542F\u670D\u52A1\u5417\uFF1F",okButtonProps:{danger:!0},onConfirm:ue.bind(null,"Restart",[u.name]),children:(0,h.jsx)(T.Z,{"data-inspector-line":"287","data-inspector-column":"16","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",disabled:pe,type:"link",children:"\u91CD\u542F"})})})]})}}];return(0,h.jsxs)(s.ZP,{"data-inspector-line":"299","data-inspector-column":"4","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",onBack:ye,title:"\u670D\u52A1\u5217\u8868",children:[(0,h.jsxs)(y.Z,{"data-inspector-line":"300","data-inspector-column":"6","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",bordered:!1,bodyStyle:{paddingBottom:0,display:"flex",width:"100%"},children:[(0,h.jsx)("div",{"data-inspector-line":"308","data-inspector-column":"8","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",style:{flex:1},children:(0,h.jsx)(W.Z,{"data-inspector-line":"309","data-inspector-column":"10","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",disabled:H,allowClear:!1,request:Ie,fieldProps:{value:fe?void 0:k,onChange:De}})}),(0,h.jsx)("div",{"data-inspector-line":"319","data-inspector-column":"8","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",style:{flex:1,display:"flex",justifyContent:"flex-end"},children:(0,h.jsx)(g.Z,{"data-inspector-line":"320","data-inspector-column":"10","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",disabled:H,checked:z,onChange:Ce.bind(null),children:"\u81EA\u52A8\u5237\u65B0"})})]}),(0,h.jsx)(a.Z,{"data-inspector-line":"329","data-inspector-column":"6","data-inspector-relative-path":"src/pages/ServerManage/Inspection/MachineServices/index.tsx",loading:H,actionRef:Ee,search:!1,dataSource:I,rowKey:"name",columns:je})]})},ve=de},79278:function(X,E,n){"use strict";n.d(E,{x:function(){return B},vz:function(){return C},rl:function(){return x},XQ:function(){return D},sV:function(){return R},Gl:function(){return T},X1:function(){return j},FF:function(){return P},Mv:function(){return w},fN:function(){return G}});var m=n(3182),y=n(94043),l=n.n(y),g=n(58075),B=function(){var c=(0,m.Z)(l().mark(function o(r){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,g.kO)("/soms/server/list",{method:"GET",params:r}));case 1:case"end":return t.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),C=function(){var c=(0,m.Z)(l().mark(function o(r){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,g.kO)("/soms/server/".concat(r),{method:"GET"}));case 1:case"end":return t.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),x=function(){var c=(0,m.Z)(l().mark(function o(r){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,g.kO)("/soms/server",{method:"POST",data:r}));case 1:case"end":return t.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),D=function(){var c=(0,m.Z)(l().mark(function o(r,e){return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.kO)("/soms/server/".concat(r),{method:"PUT",data:e}));case 1:case"end":return a.stop()}},o)}));return function(r,e){return c.apply(this,arguments)}}(),R=function(){var c=(0,m.Z)(l().mark(function o(r){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,g.kO)("/soms/server/".concat(r),{method:"DELETE"}));case 1:case"end":return t.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),T=function(){var c=(0,m.Z)(l().mark(function o(r){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,g.kO)("/soms/server/services/".concat(r),{method:"GET"}));case 1:case"end":return t.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),j=function(){var c=(0,m.Z)(l().mark(function o(r,e,t){return l().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,g.kO)("/soms/server/serviceops/".concat(r),{method:"POST",data:{id:r,ops:e,names:t}}));case 1:case"end":return s.stop()}},o)}));return function(r,e,t){return c.apply(this,arguments)}}(),P=function(){var c=(0,m.Z)(l().mark(function o(r){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,g.kO)("/soms/server/services",{method:"POST",data:r}));case 1:case"end":return t.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),w=function(){var c=(0,m.Z)(l().mark(function o(r,e){return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.kO)("/soms/server/service/batchops/".concat(r),{method:"POST",data:{id:r,ops:e},timeout:6e4}));case 1:case"end":return a.stop()}},o)}));return function(r,e){return c.apply(this,arguments)}}(),G=function(){var c=(0,m.Z)(l().mark(function o(r,e,t){return l().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,g.kO)("/soms/server/service/batchops",{method:"POST",data:{ids:r,ops:e,name:t}}));case 1:case"end":return s.stop()}},o)}));return function(r,e,t){return c.apply(this,arguments)}}()}}]);
