(self.webpackChunktomp=self.webpackChunktomp||[]).push([[7564],{66164:function(W){W.exports={chartsHeader:"chartsHeader___AG5u1",chartsBody:"chartsBody___3XThd",tooltip:"tooltip___M7CGx"}},37598:function(W,I,t){"use strict";var w=t(11849),G=t(22542),k=t(85893),F=function(M){var q={search:!1,options:!1,pagination:{defaultPageSize:15,pageSizeOptions:["15","30","50"],showSizeChanger:!0}};return(0,k.jsx)(G.ZP,(0,w.Z)({"data-inspector-line":"21","data-inspector-column":"9","data-inspector-relative-path":"src/components/CustomProTable/index.tsx"},Object.assign({},q,M)))};I.Z=F},84194:function(W,I,t){"use strict";t.r(I),t.d(I,{default:function(){return Dt}});var w=t(13254),G=t(14277),k=t(18106),F=t(51752),rt=t(58024),M=t(39144),q=t(49111),ot=t(19650),Ft=t(57663),dt=t(71577),Mt=t(89032),$=t(15746),bt=t(34792),H=t(48086),_=t(3182),f=t(11849),D=t(2824),lt=t(94043),b=t.n(lt),C=t(67294),ct=t(67265),tt=t(64317),ut=t(34540),vt=t(30381),j=t.n(vt),at=t(2489),pt=t(44656),ft=t(80549),R=t(14877),et=t(32059),gt=t(37598),mt=t(40041),xt=t(66164),A=t.n(xt),i=t(85893),ht=function(g){var P=g.title,l=P===void 0?"":P,K=g.tabCode,z=g.usageData,L=z||{},Y=L.rtcList,T=L.valueaddedList,Q=(0,C.useState)("duration"),E=(0,D.Z)(Q,2),m=E[0],V=E[1],y=[{code:"rtc",dataSet:Y},{code:"valueadded",dataSet:T}].reduce(function(U,h){var c,v,u,p=h.code,o=h.dataSet;return(0,f.Z)((0,f.Z)({},U),{},(0,et.Z)({},p,{title:l,xAxis:(o==null||(c=o.sum)===null||c===void 0?void 0:c.map(function(B){return B.reportDate}))||[],durationSeries:(o==null||(v=o.sum)===null||v===void 0?void 0:v.map(function(B){return B.duration}))||[],flowSeries:(o==null||(u=o.sum)===null||u===void 0?void 0:u.map(function(B){return B.netflow}))||[]}))},{}),X=[{code:"rtc",dataSet:Y},{code:"valueadded",dataSet:T}].reduce(function(U,h){var c,v=h.code,u=h.dataSet;return(0,f.Z)((0,f.Z)({},U),{},(0,et.Z)({},v,(u==null||(c=u.sum)===null||c===void 0?void 0:c.map(function(p){return(0,f.Z)((0,f.Z)({},p),{},{reportDate:p.reportDate})}))||[]))},{}),O=[{title:"\u65E5\u671F",dataIndex:"reportDate"},{title:"\u65F6\u957F (min)",dataIndex:"duration",hideInTable:m!=="duration"},{title:"\u6D41\u91CF (MB)",dataIndex:"netflow",hideInTable:m!=="netflow"}],x=y[K],J=X[K];return(0,i.jsxs)($.Z,{"data-inspector-line":"67","data-inspector-column":"4","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/Usage/index.tsx",children:[(0,i.jsx)($.Z,{"data-inspector-line":"68","data-inspector-column":"6","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/Usage/index.tsx",className:A().chartsHeader,children:(0,i.jsx)(tt.Z,{"data-inspector-line":"69","data-inspector-column":"8","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/Usage/index.tsx",allowClear:!1,options:[{label:"\u65F6\u957F",value:"duration"},{label:"\u6D41\u91CF",value:"netflow"}],fieldProps:{defaultValue:"duration",onChange:function(h){var c,v,u,p;V(h),g==null||(c=g.actionRef.current)===null||c===void 0||(v=c.reload)===null||v===void 0||v.call(c),g==null||(u=g.actionRef.current)===null||u===void 0||(p=u.setPageInfo)===null||p===void 0||p.call(u,{current:1})},placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u6307\u6807"}})}),(0,i.jsx)($.Z,{"data-inspector-line":"92","data-inspector-column":"6","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/Usage/index.tsx",className:A().chartsBody,children:x?(0,i.jsx)(mt.Z,{"data-inspector-line":"94","data-inspector-column":"10","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/Usage/index.tsx",title:[{text:x.title}],xAxis:{type:"category",data:x.xAxis,boundaryGap:!1},yAxis:{type:"value",min:0,max:m==="duration"?x.durationSeries.length?void 0:60:m==="netflow"&&x.flowSeries.length?void 0:100,minInterval:5,name:m==="duration"?"(min)":m==="netflow"?"(MB)":"",axisLabel:{formatter:"{value}"}},series:[{data:m==="duration"?x.durationSeries:m==="netflow"?x.flowSeries:[],type:"line"}],tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:function(h){var c=(0,D.Z)(h,1),v=c[0],u=v.axisValue,p=v.data;return`<div>
                  <div class="`.concat(A().tooltip,`">
                    <div>\u65F6\u95F4\uFF1A</div>
                    <div>`).concat(u,`</div>
                  </div>
                  <div class="`).concat(A().tooltip,`">
                    <div>\u7528\u91CF\uFF1A</div>
                    <div>`).concat(p," ").concat(m==="duration"?"min":m==="netflow"?"MB":"",`
                  </div>
                  </div>
                </div>`)}},styles:{width:"100%",margin:"0 auto 10px"}},x.title):(0,i.jsx)(i.Fragment,{})}),(0,i.jsx)(gt.Z,{"data-inspector-line":"166","data-inspector-column":"6","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/Usage/index.tsx",actionRef:g.actionRef,dataSource:J||[],options:!1,rowKey:"reportDate",search:!1,columns:O})]})},St=ht,Ct=t(30097),yt=t(28617),Zt=function(){var g=(0,C.useState)([j()().subtract(7,"days"),j()().subtract(1,"days")]),P=(0,D.Z)(g,2),l=P[0],K=P[1],z=(0,C.useState)([]),L=(0,D.Z)(z,2),Y=L[0],T=L[1],Q=(0,C.useState)(),E=(0,D.Z)(Q,2),m=E[0],V=E[1],y=(0,C.useRef)(),X="YYYY.MM.DD",O=at.m8.location.query,x=[{code:"rtc",title:"RTC\u7528\u91CF"},{code:"valueadded",title:"\u5F55\u5236\u7528\u91CF"}],J=(0,C.useState)((O==null?void 0:O.tabCode)||x[0].code),U=(0,D.Z)(J,2),h=U[0],c=U[1],v=function(e){var n,r,a,s;c(e),(n=y.current)===null||n===void 0||(r=n.reload)===null||r===void 0||r.call(n),(a=y.current)===null||a===void 0||(s=a.setPageInfo)===null||s===void 0||s.call(a,{current:1}),at.m8.replace({query:(0,f.Z)((0,f.Z)({},O),{},{tabCode:e})})},u=(0,C.useState)(),p=(0,D.Z)(u,2),o=p[0],B=p[1],Bt=(0,C.useState)(),nt=(0,D.Z)(Bt,2),$t=nt[0],Rt=nt[1],N=function(e){return e&&(0,R.Vb)(e)},st=180,Ot=function(e){T(e.map(N))},jt=function(){return[N(j()()).subtract(2,"days"),N(j()()).subtract(1,"days")]},Pt=function(e){e?(V([]),T([])):V(void 0)},Lt=function(e){var n,r,a,s;K(e.map(N)||jt()),(n=y.current)===null||n===void 0||(r=n.reload)===null||r===void 0||r.call(n),(a=y.current)===null||a===void 0||(s=a.setPageInfo)===null||s===void 0||s.call(a,{current:1})},Tt=function(){var d=(0,_.Z)(b().mark(function e(){var n,r,a,s;return b().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,(0,pt.AY)({data:{page:0,limit:1e4,licenseId:0}});case 2:return n=Z.sent,r=n.data||{},a=r.dataList,s=a===void 0?[]:a,Z.abrupt("return",s.map(function(it){return{label:it.appName,value:it.appId}}));case 5:case"end":return Z.stop()}},e)}));return function(){return d.apply(this,arguments)}}(),Et=function(){var d=(0,_.Z)(b().mark(function e(){var n;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=o+"\u7528\u91CF\u6570\u636E\u7EDF\u8BA1"+(0,R.FK)(Number(l[0]))+"-"+(0,R.FK)(Number(l[1])),a.next=3,(0,Ct.SP)({data:{usageSources:"0",usageModes:"1,6",appId:(o==null?void 0:o.toString())||"",startTime:(0,R.KR)(Number(l[0])),endTime:(0,R.KR)(Number(l[1])),exportFlag:!0}}).then(function(s){(0,yt.r)(s,n)});case 3:case"end":return a.stop()}},e)}));return function(){return d.apply(this,arguments)}}(),It=function(){if(o)if(l.length)Et();else{H.default.warn("\u65F6\u95F4\u5FC5\u586B");return}else{H.default.warn("\u8BF7\u9009\u62E9\u5E94\u7528");return}};return(0,C.useEffect)(function(){if(!(!o||!l||!l[0]||!l[1])){var d=function(n){var r=n.rtcList||{},a=r.client,s=r.record;return{appId:n.appId,rtcList:{sum:(a==null?void 0:a.map(function(S){return(0,f.Z)((0,f.Z)({},S),{},{netflow:S.media})}))||[]},valueaddedList:{sum:(s==null?void 0:s.map(function(S){return(0,f.Z)((0,f.Z)({},S),{},{netflow:S.media})}))||[]}}};(0,ft.eL)({data:{usageSources:"0",usageModes:"1,6",appId:String(o),startTime:l[0].unix(),endTime:l[1].unix()}}).then(function(e){if(e.code===0){var n=l[0].year()===l[1].year()?"MM.DD":"YYYY.MM.DD",r=d(e.data);["rtcList","valueaddedList","playList","publishList"].forEach(function(a){var s,S;return(s=r[a])===null||s===void 0||(S=s.sum)===null||S===void 0?void 0:S.map(function(Z){Z.reportDate=j()(Z.reportDate).format(n)})}),Rt(r)}else e.msg&&H.default.error(e.msg)}),console.log("app or date changed",o,l)}},[o,l]),(0,i.jsx)(ct.ZP,{"data-inspector-line":"182","data-inspector-column":"4","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",children:(0,i.jsxs)(M.Z,{"data-inspector-line":"183","data-inspector-column":"6","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",children:[(0,i.jsx)(M.Z,{"data-inspector-line":"184","data-inspector-column":"8","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",style:{marginBottom:"16px"},bordered:!1,bodyStyle:{paddingBottom:0},children:(0,i.jsxs)(ot.Z,{"data-inspector-line":"185","data-inspector-column":"10","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",children:[(0,i.jsx)($.Z,{"data-inspector-line":"186","data-inspector-column":"12","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",children:(0,i.jsx)(tt.Z,{"data-inspector-line":"187","data-inspector-column":"14","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",label:"\u5E94\u7528",allowClear:!0,width:200,request:Tt,fieldProps:{placeholder:"\u8BF7\u9009\u62E9\u5E94\u7528",onChange:function(e){var n,r,a,s;B(e),(n=y.current)===null||n===void 0||(r=n.reload)===null||r===void 0||r.call(n),(a=y.current)===null||a===void 0||(s=a.setPageInfo)===null||s===void 0||s.call(a,{current:1})}}})}),(0,i.jsx)($.Z,{"data-inspector-line":"202","data-inspector-column":"12","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",children:(0,i.jsx)(ut.Z,{"data-inspector-line":"203","data-inspector-column":"14","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",tooltip:"\u65E5\u671F\u8DE8\u5EA6\u4E0D\u80FD\u8D85\u8FC7".concat(st,"\u5929"),label:"\u65F6\u95F4",allowClear:!0,width:"lg",fieldProps:{allowClear:!1,value:m||l,format:X,disabledDate:function(e){return(0,R.Q8)(e,Y||[],st)},onCalendarChange:Ot,onChange:Lt,onOpenChange:Pt}})}),(0,i.jsx)($.Z,{"data-inspector-line":"219","data-inspector-column":"12","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",style:{marginBottom:"25px",marginLeft:"18px"},children:(0,i.jsx)(dt.Z,{"data-inspector-line":"220","data-inspector-column":"14","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",type:"primary",onClick:It,children:"\u5BFC\u51FA"})})]})}),o?(0,i.jsx)(F.Z,{"data-inspector-line":"227","data-inspector-column":"10","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",activeKey:h||x[0].code,onChange:v,children:x.map(function(d){return(0,i.jsx)(F.Z.TabPane,{"data-inspector-line":"229","data-inspector-column":"14","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",tab:d.title,children:(0,i.jsx)(St,{"data-inspector-line":"230","data-inspector-column":"16","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",actionRef:y,title:d.title,tabCode:d.code,usageData:$t})},d.code)})}):(0,i.jsx)(G.Z,{"data-inspector-line":"240","data-inspector-column":"10","data-inspector-relative-path":"src/pages/BusinessOperation/UsageStatistics/index.tsx",description:"\u8BF7\u9009\u62E9\u5E94\u7528\u540E\u67E5\u770B\u6570\u636E"})]})})},Dt=Zt}}]);
